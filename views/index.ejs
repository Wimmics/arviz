<!DOCTYPE html>
<html lang="en">

<head>
    <title>ARViz</title>
    <meta charset="UTF-8">

    <!-- tooltip -->
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>

    <!-- js scripts -->
    <script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>
    <script type="text/javascript" src="https://d3js.org/d3-selection-multi.v1.min.js"></script>
    <script type="text/javascript" src="https://d3js.org/d3-color.v2.min.js"></script>
    <script type="text/javascript" src="https://d3js.org/d3-interpolate.v2.min.js"></script>
    <script type="text/javascript" src="https://d3js.org/d3-scale-chromatic.v2.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/d3-legend/1.1.0/d3-legend.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- stylesheets -->
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/themes/light.css"/>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/animations/scale.css"/>

    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" media="all" />

    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- ARViz-related files -->
    <!-- CSS -->
    <link rel="stylesheet" href="/arviz/css/common.css">
    <link rel="stylesheet" href="/arviz/css/graph_viz.css">
    <link rel="stylesheet" href="/arviz/css/chordDiagram.css">

    <!-- libs -->
    <script type="text/javascript" src='/arviz/lib/FileSaver.js'></script>
    <script type="text/javascript" src="/arviz/lib/simple_statistics.js"></script>	
    <script type="text/javascript" src="/arviz/lib/dragscroll.js"></script>	

    <script type="text/javascript" src="/arviz/lib/d3-context-menu/d3-context-menu.js"></script>
    <link rel="stylesheet" href="/arviz/lib/d3-context-menu/d3-context-menu.css">
    <script type="text/javascript" src="/arviz/lib/d3-forkchord.js"></script>

    <!-- interface js -->
    <script type="text/javascript" src="/arviz/js/utils.js"></script>
    <script type="text/javascript" src="/arviz/js/autocomplete.js"></script>
    <script type="text/javascript" src="/arviz/js/contextmenu.js"></script>
    <script type="text/javascript" src="/arviz/js/querying.js"></script>
    <script type="text/javascript" src="/arviz/js/details_on_demand.js"></script>
    <script type="text/javascript" src="/arviz/js/configPanel.js"></script>
    <script type="text/javascript" src="/arviz/js/scatterPlot.js"></script>
    <script type="text/javascript" src="/arviz/js/graphViz.js"></script>
    <script type="text/javascript" src="/arviz/js/chordDiagram.js"></script>
     
</head>

<body>
    <div class="tooltip"></div>

    <!-- left side buttons -- settings for the current data and visual tools -->
    <div class='menu-buttons' >
        <div class="menu-icon left-icon" id='legend_button'>
            <span><i class="fas fa-palette"></i></span>
        </div>
        <div class="menu-icon left-icon" id='data-filter_button'>
            <span><i class="fas fa-filter"></i></span>
        </div>
        <div class="menu-icon left-icon" id='data-sort_button'>
            <span><i class="fas fa-sort"></i></span>
        </div>
        <div class="menu-icon left-icon" style='top: 20px;' id='about'>
            <span><a href='javascript:void(0);' onclick="about()"><i class="fas fa-info-circle"></i></a></span>
        </div>
    </div>

    <!-- divs activated by the buttons above -->
    <div class='sideNav-bar' id='legend'></div>
    <div class='sideNav-bar' id='data-filter'></div>
    <div class='sideNav-bar' id='data-sort'></div>
    <div class='sideNav-bar' id='upload-file'></div>

    <div class='visu-space'>
        <!-- tabs that enable switching between views -->
        <div class="tab-bar" onclick="charts.scatterplot.setScatterPlot();" id='scatterplot-tab'>Overview of Rules</div>
        <div class="tab-bar" onclick="charts.chord.setChordDiagramView();" id='chord-tab'>Circular Paginated View of Subsets</div>
        <div class="tab-bar" onclick="charts.graph.setGraphView();" id='graph-tab'>Exploratory Graph View of Items</div>

        <!-- the div that will contain the views -->
        <div class='viewContainer'>
            <div id="vis-loading" style="margin-top:30%; margin-left:50%; font-size: 40px;">
                <i class="fa fa-refresh fa-spin" ></i>
            </div>
            
        </div>
        
        <!-- the forms below are only enabled for the association graph view -->
        <datalist id="labels_list"></datalist>
        <div class='forms'>
            <div class='left' id='antecedentSide'>
                <form autocomplete="off" onsubmit="handleInput(event)">
                    <div class="autocomplete">
                        <label class='text-div'>Search rules by</label> 
                        <input id="antecedentInput" list="labels_list" type="text" name="source" placeholder="Antecedent">
                        <input type="submit" value="Go">    
                        <i class="fa fa-refresh fa-spin labels-loading"></i>
                    </div>
                </form>  
            </div>
            <div class='right' id='consequentSide'>
                <form autocomplete="off" onsubmit="handleInput(event)">
                    <div class="autocomplete">
                        <label class='text-div'>Search rules by</label> 
                        <input id="consequentInput" type="text" name="target" placeholder="Consequent" list="labels_list">
                        <input type="submit" value="Go">
                        <i class="fa fa-refresh fa-spin labels-loading"></i>
                    </div>
                </form>  
            </div>
        </div>
        
        <!-- the forms below are enabled together with the circular view -->
        <div class="options">
            <div class="rotationValueNav">
                <label class="rotationNavText"></label>
                <button id='rotationValuePrevious' onclick="charts.circular.decreaseRotationValue()">Previous</button>
                <input type='text' id='rotationValueInput' onchange="charts.circular.updateRotationValue(event)"></input>
                <button id='rotationValueNext' onclick="charts.circular.increaseRotationValue()">Next</button>
                <label class="rotationNavText2"></label>
            </div>
            <!-- <div class='bottom-button'>
                <button onclick="setGraphView('all', null)">Display all terms</button>
            </div> -->
        </div>

    </div>

    <script>
        const appli = <%- JSON.stringify(appli) %>;
        // const config = ;
        // let data, filteredData;

        // chord diagram nodes' settings
        

        let height, width, 
            activeChart = null,
            configPanel,
            charts = { graph: null, chord: null, scatterplot: null },
            uris;
        
        window.addEventListener('load', async (event) => {

            await getLabelsURI()
            d3.selectAll('.labels-loading').style('display', 'none')
            d3.select('#vis-loading').style('display', 'none')

            // set page 
            const div = d3.select('div.viewContainer')
            width = div.node().clientWidth
            height = div.node().clientHeight

            // set menu buttons interaction
            d3.selectAll('div.menu-icon')
                .filter(function() { return this.id != 'about'; })
                .on('click', openNav)
                .on('mouseenter', showSideButtonTooltip)
                .on('mouseleave', hideTooltip)

            configPanel =  new ConfigPanel(<%- JSON.stringify(config) %>)
            charts.graph = new GraphView()
            charts.chord = new CircularView()
            charts.scatterplot = new ScatterPlot()

            // legend
            configPanel.setColors()
            configPanel.setLegends()

            // filtering and sorting panels
            configPanel.setFilteringCriteria()
            configPanel.setSortPanel()
            configPanel.setFilterPanel()
            configPanel.updateFilteringKeys()
            setInfoTooltip()

            charts.graph.setGraphView()
            // charts.circular.setChordDiagramView()
            // charts.scatterplot.setScatterPlot()

        })

        // handle the submit action from the graph view's forms
        function handleInput(event){
            event.preventDefault();
            if (event.submitter.nodeName == 'BUTTON') return;
            let type = event.srcElement[0].name;
            let value = document.getElementById(event.srcElement[0].id).value;
            charts.graph.setGraphView(type, value)

            if (type == 'source') document.getElementById('consequentInput').value = '';
            else document.getElementById('antecedentInput').value = '';
        }       
        
        function about(event) {
            window.open('/arviz/' + appli + '/about')
        }
        
    </script>

    
      

</body>
</html>